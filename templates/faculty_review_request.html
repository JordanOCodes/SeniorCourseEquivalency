{% extends "template.html" %}
{% block content %}


    <div class="testbox">
        <form id="request-form" method="POST">
            <p>Please review the information below.</p>
            <hr/>
            <input type="text" name="request_id" value="{{ request_dict["RequestID"] }}" style="display: none" checked>
            <input type="text" name="the_date" value="{{ request_dict["TheDate"] }}" style="display: none" checked>



            <fieldset>
                <legend>Student Information</legend>
                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="first_name">First Name</label>
                            <input type="text" name="first_name" value="{{ request_dict["FirstName"] | safe }}"readonly/>
                        </div>
                        <div>
                            <label for="last_name">Last Name</label>
                            <input type="text" name="last_name" value="{{ request_dict["LastName"] | safe }}"readonly/>
                        </div>
                    </div>

                    <div class="item">
                        <label for="ufid">UFID</label>
                        <input type="text" name="ufid" value="{{ request_dict["UFID"] | safe }}" readonly/>
                    </div>

                    <div class="item">
                        <label for="student_email">E-mail Address</label>
                        <input type="email" name="email" value="{{ request_dict["email"] | safe }}" readonly/>
                    </div>
                </div>
            </fieldset>
            </br>

            <fieldset>
                <legend>Course At UF</legend>
                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="course_id">Course ID</label>
                            <input type="text" name="course_id" value="{{ request_dict["UFCourseID"] | safe }}"readonly/>
                        </div>
                        <div>
                            <label for="course_title">Course Title</label>
                            <input type="text" name="course_title" value="{{ request_dict["UFCourseTitle"] | safe }}"readonly/>
                        </div>
                    </div>
                </div>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="credits">Credits</label>
                            <input type="text" name="credits" value="{{ request_dict["UFCredits"] | safe }}"readonly/>
                        </div>
                        <div>
                            <label for="department">Department offering course: {{ department | safe}}</label>
                            <input type="text" name="department" value="{{ request_dict["UFDepartment"] | safe }}"readonly/>
                        </div>
                    </div>
                </div>


            </fieldset> <br>



                <input type="text" name="second_class" id="second_class" value="{{ request_dict["IsSecondClass"] }}" style="display: none" checked>


            <script>

                window.onload = function() {
                    const subArrayHidden = ["first_course_title", "second_course", "second_course_document_newline"];
                        for (const element of subArrayHidden){toggleHidden(document.getElementById("second_class"), element);}

                    };
                    function toggleHidden(box, id) {
                        const el = document.getElementById(id);
                        if ( box.value === "1" ) {
                            el.style.display = '';
                        } else {
                            el.style.display = 'none';
                        }
                    }


            </script>


            <fieldset>
                <legend><i id="first_course_title" style="display: none">First</i> Requested Course Substitution</legend>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="sub_course_id">Course ID<span>*</span></label>
                            <input type="text" name="sub_course_id"  value="{{ request_dict["FirstCourseID"] | safe }}" readonly=/>
                        </div>
                        <div>
                            <label for="sub_course_title">Course Title<span>*</span></label>
                            <input type="text" name="sub_course_title" value="{{ request_dict["FirstCourseTitle"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>


            <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="sub_credits">Credits<span>*</span></label>
                            <input type="text" name="sub_credits" value="{{ request_dict["FirstCredits"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="sub_university">University Where Course was taken<span>*</span></label>
                            <input type="text" name="sub_university" value="{{ request_dict["FirstUniversity"] | safe }}" readonly/>
                        </div>
                        {% if request_dict["FirstUniversity"] == "University Of Florida" %}
                        <div>
                            <label for="sub_department">Department at University of Florida<span>*</span></label>
                            <input type="text" name="sub_department" value="{{ request_dict["FirstDepartment"] | safe }}" readonly/>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="sub_term">Term Taken<span>*</span></label>
                            <input type="text" name="sub_term" value="{{ request_dict["FirstTerm"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="sub_grade">Grade Received<span>*</span></label>
                            <input type="text" name="sub_grade" value="{{ request_dict["FirstGrade"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>

                <div class="item">
                        <label for="sub_email">Instructor's E-mail Address<span>*</span></label>
                        <input type="email" name="sub_email" value="{{ request_dict["FirstInstructorEmail"] | safe }}" readonly/>
                    </div>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="sub_textbook">Primary Textbook Title<span>*</span></label>
                            <input type="text" name="sub_textbook" value="{{ request_dict["FirstTextbook"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="sub_author">Primary Textbook's Author<span>*</span></label>
                            <input type="text" name="sub_author" name="sub_author" value="{{ request_dict["FirstAuthor"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>

                    </fieldset> <br>
                <br>
















            <fieldset id="second_course" style="display: none">
                <legend><i>Second</i> Requested Course Substitution</legend>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="second_sub_course_id">Course ID<span>*</span></label>
                            <input type="text" id="second_sub_course_id" name="second_sub_course_id"  value="{{ request_dict["SecondCourseID"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="second_sub_course_title">Course Title<span>*</span></label>
                            <input type="text" id="second_sub_course_title" name="second_sub_course_title" value="{{ request_dict["SecondCourseTitle"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>


            <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="second_sub_credits">Credits<span>*</span></label>
                            <input type="text" id="second_sub_credits" name="second_sub_credits" value="{{ request_dict["SecondCredits"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="second_sub_university">University Where Course was taken<span>*</span></label>
                            <input type="text" id="second_sub_university" name="second_sub_university" value="{{ request_dict["SecondUniversity"] | safe }}" readonly>
                        </div>
                        {% if request_dict["SecondUniversity"] == "University Of Florida" %}
                        <div>
                            <label for="second_sub_department">Department at University of Florida<span>*</span></label>
                            <input type="text" name="second_sub_department" value="{{ request_dict["SecondDepartment"] | safe }}" readonly/>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="second_sub_term">Term Taken<span>*</span></label>
                            <input type="text" id="second_sub_term" name="second_sub_term" value="{{ request_dict["SecondTerm"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="second_sub_grade">Grade Received<span>*</span></label>
                            <input type="text" id="second_sub_grade" name="second_sub_grade" value="{{ request_dict["SecondGrade"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>

                <div class="item">
                        <label for="second_sub_email">Instructor's E-mail Address<span>*</span></label>
                        <input type="email" id="second_sub_email" value="{{ request_dict["SecondInstructorEmail"] | safe }}" readonly/>
                    </div>

                <div class="item">
                    <div class="name-item">
                        <div>
                            <label for="second_sub_textbook">Primary Textbook Title<span>*</span></label>
                            <input type="text" id="second_sub_textbook" name="second_sub_textbook" value="{{ request_dict["SecondTextbook"] | safe }}" readonly/>
                        </div>
                        <div>
                            <label for="second_sub_author">Primary Textbook's Author</label>
                            <input type="text" id="second_sub_author" name="second_sub_author" value="{{ request_dict["SecondAuthor"] | safe }}" readonly/>
                        </div>
                    </div>
                </div>

                    </fieldset> <br>

            <br id="second_course_document_newline" style="display: none">

            <fieldset>
                <legend>Other Comments</legend>
                 <div class="item">
                        <label for="other_comments">Other Comments made by the Student</label>
                        <input type="text" name="other_comments" value="{{ request_dict["OtherComments"] | safe }}" readonly/>
                    </div>

            </fieldset><br>








<h2>Vertical Tabs</h2>
<p>All the Topics appear here, you can click on them and check them off one by one until they are all crossed off</p>
<div class="item" style="display:flex; flex-direction: column; justify-content: flex-start;">

{{ html_tabs | safe }}


<div class="item" style="display:flex; flex-direction: row; justify-content: flex-start;">


{%for i in range(0, 24)%}
<div id="file{{i}}" class="tabcontent">
    <embed
    src="{{ url_for("static", filename=file_paths_list[i]) }}"
    type="text/html" frameBorder="0" scrolling="auto" height="100%" width="100%">
</div>
{%endfor%}

<div style="display: flex;flex-wrap: nowrap; flex-direction: column; justify-content: flex-start;width: 30%;">
{%for i in range(0, 20)%}
    {% if course_topic_list[i] != "" and course_topic_list[i] != "N/A" %}
        <div style="display: flex;flex-wrap: nowrap; flex-direction: row;  margin-bottom: 5px; justify-content: flex-start">
            <div class="the_faculty_check_div" style="">
                <input type="checkbox" class="checkbox" id="check_topic{{i}}" value="{{course_topic_locations[i]}}" style="display: none">
                <span id="{{i}}" class="faculty_checks" onClick="facultyCheckClick.call(this);" style="color: black">&#9744;</span>
            </div>
            <div style="">
                <span id="check_text{{i}}" style="display: inline;color: black;">
                    {{course_topic_list[i]}}
                </span><hr>
            </div>
        </div>
    {% endif %}
{%endfor%}
</div>

</div>
</div>
<script>

function openFile(the_id, fileName) {
  let i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(fileName).style.display = "block";
  document.getElementById(the_id).className += " active";

  // Take care of highlighting each checkbox
  let checkboxes = document.getElementsByClassName("checkbox");
  let numFileLoc = parseInt(fileName.substring(4));
  for (i = 0; i < checkboxes.length; i++) {
      let theCheckText = document.getElementById("check_text" + i.toString());
      if (checkboxes[i].value[numFileLoc] === "1") {
          theCheckText.classList.add('topic_found');
          theCheckText.classList.remove('topic_missing');
      }
      else {
          theCheckText.classList.add('topic_missing');
          theCheckText.classList.remove('topic_found');
      }

  }
}

// Get the element that will be  defaulted to be open and click on it
document.getElementById("tab0").click();



function facultyCheckClick(){
  if (this.innerHTML === "☐"){
  	this.innerHTML = "&#9746";
    this.style.color = "red";
  }
  else if (this.innerHTML === "☒"){
  	this.innerHTML = "&#9745";
    this.style.color = "green";
  }
  else if (this.innerHTML === "☑"){
  	this.innerHTML = "&#9744";
    this.style.color = "black";
  }
}
</script>

<br>

        <fieldset>
                <legend>Comments for the student</legend>
                 <div class="item">
                        <label for="faculty_comments">Comments for the student about their request.</label>
                        <input type="text" name="faculty_comments" placeholder="Give comments for the student here" />
                    </div>

            </fieldset><br>


                        <div class="btn-block">
                            <button type="button" style="margin-right: 15px; background-color: red" onclick="openDenyForm()">Deny</button>
                            <button type="button" style="margin-left: 15px; background-color: green;" onclick="openApproveForm()">Approve</button>
                        </div>


            <div id="popupDenyForm" class="modal">
              <div class="modal-content">
                  <div class="popup-form">
                    <h2>Are you sure you'd like to deny this request?
                    </h2>
                    <button type="button" style="background-color: red;" onclick="checkFinalDenySubmit()">DENY</button><br><br>
                    <button type="button" onclick="closeDenyForm()">Close</button>
                  </div>
              </div>
            </div>

            <div id="popupApproveForm" class="modal">
              <div class="modal-content">
                  <div class="popup-form">
                    <h2>Are you sure you'd like to Approve this request?
                    </h2>
                    <button type="button" style="background-color: green;" onclick="checkFinalApproveSubmit()">APPROVE</button><br><br>
                    <button type="button" onclick="closeApproveForm()">Close</button>
                  </div>
              </div>
            </div>

            <script>
            function openDenyForm() {
                document.getElementById("popupDenyForm").style.display = "block";
            }
            function closeDenyForm() {
                document.getElementById("popupDenyForm").style.display = "none";
            }
            function openApproveForm() {
                document.getElementById("popupApproveForm").style.display = "block";
            }
            function closeApproveForm() {
                document.getElementById("popupApproveForm").style.display = "none";
            }
            </script>

            <script>
                function checkFinalDenySubmit(){
                    ApprovedOrDenied('Denied');
                    document.getElementById("request-form").submit();
                }
                function checkFinalApproveSubmit(){
                    ApprovedOrDenied('Approved');
                    document.getElementById("request-form").submit();
                }
                function ApprovedOrDenied(str){
                    const ApprovedOrDenied = document.createElement('input');
                    ApprovedOrDenied.setAttribute('type', 'text');
                    ApprovedOrDenied.setAttribute('name', 'ApprovedOrDenied');
                    ApprovedOrDenied.setAttribute('type', 'hidden');
                    ApprovedOrDenied.setAttribute('value', str);
                    const theForm = document.getElementById("request-form");
                    theForm.appendChild(ApprovedOrDenied);
                }
            </script>

        </form>
    </div>




            <script>
                var timer;
                var timerStart;
                var timeSpentOnSite = getTimeSpentOnSite();

                function getTimeSpentOnSite(){
                    timeSpentOnSite = parseInt(localStorage.getItem('timeSpentOnSite'));
                    timeSpentOnSite = isNaN(timeSpentOnSite) ? 0 : timeSpentOnSite;
                    return timeSpentOnSite;
                }

                function startCounting(){
                        timerStart = Date.now();
                        timer = setInterval(function(){
                            timeSpentOnSite = getTimeSpentOnSite()+(Date.now()-timerStart);
                            localStorage.setItem('timeSpentOnSite',timeSpentOnSite);
                            timerStart = parseInt(Date.now());
                        timeSpentOnSiteSecond = parseInt(timeSpentOnSite/1000);
                        if (timeSpentOnSiteSecond > 2700){
                            var answer = window.confirm("Your Session is about to end.\nDo you wish to continue?\nPress OK within 15 minutes to stay logged in.\nCancel to logout.");
                            if (answer){
                                localStorage.setItem('timeSpentOnSite', 0);
                                let request = new XMLHttpRequest();
                                request.onload = function() {
                                      let requestStr = request.responseText;
                                      if (requestStr === "False"){
                                          alert("I apologize, but your session has timed out.");
                                          window.location.replace("{{ url_for('student_root') }}");
                                      }
                                  };
                                request.open("GET", "/renew_session_lifetime", true);
                                request.send();
                            }
                            else {
                                //
                                localStorage.setItem('timeSpentOnSite', 0);
                                let request = new XMLHttpRequest();
                                request.onload = function() {
                                };
                                request.open("GET", "/clear_session_lifetime", true);
                                request.send();
                                window.location.replace("{{ url_for('student_root') }}");
                            }
                        }},1000);
                }
                startCounting();

            </script>
{% endblock %}